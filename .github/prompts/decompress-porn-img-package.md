# 解压图片压缩包

为我制作一个独立的 node 包，我将用这个名为 `@ruan-cat/decompress-porn-img-package` 包，简称为 `解压图片压缩包工具` 。

预期通过运行 `@ruan-cat/decompress-porn-img-package {path}` 命令的方式，实现读取绝对路径 path 内的文件，并按照预设的固定逻辑来处理文件。

## 术语说明

- `本项目` ： 即 `scripts\decompress-porn-img-package` 目录内的 node 项目。
- `解压图片压缩包工具` ： 即 `@ruan-cat/decompress-porn-img-package` 包。

## 配置文件 `decompress-porn-img-package.config.ts` 应该提供的配置项

- password ： 用于解压压缩包的密码。默认解压密码为字符串 `https://www.91xiezhen.top` 。
- dirtyFiles ：要被删除的脏文件文件名数组。在处理文件时，会有很多文件。默认有文件 `孔雀海` 的 Internet 快捷方式
- isPureDecompress ： 是否是纯解压压缩包模式？默认为**是**。
- isDecompressMixedNamedPackages ： 是否解压混合命名风格的压缩包？默认为**否**。
- isDeletePackages ： 是否删除已经被解压的压缩包？默认为**否**。
- isMoveFilesToRoot ： 是否移动文件到初次解压文件的根目录？默认为**是**。
- isRenameRootFolder ： 是否用最后一次解压的压缩包名称来重命名根解压文件目录名称？默认为**是**。

## 核心业务处理逻辑

此处的处理逻辑是固定的，未来变更时会有少部分的修改，但是大体核心需求不会变，即按照流程解压并整理文件。

### 1 读取绝对路径地址

1. 根据我提供给你的绝对路径文件夹地址，访问并开始工作。
2. 如果我没有提供有效的绝对路径地址，那么就退出并提示我应该提供地址。
3. 主要处理的绝对路径文件夹地址，是 window 系统内的地址，比如：
   - `C:\Users\pc\Desktop\test`
   - `D:\store\baidu\048.蠢沫沫`
   - `D:\store\baidu\315.咬一口兔娘`
4. 这些文件夹地址名称会包含中文。

### 2 识别纯数值命名的压缩包文件，并解压到独立的文件夹内

1. 找到纯数值命名的压缩包，比如 `031.gz` ，`125.zip` 这样的文件。这些文件才是你这个阶段需要处理的文件。
2. 如果你发现存在其他命名规则的压缩包，比如 `022咬.gz` 这样命名的，混杂有中文的压缩包，根据配置 `isDecompressMixedNamedPackages` 来决定是否解压。
3. 解压到独立的文件夹内，解压后的文件夹目录结构如下例子所示：

在文件夹 `C:\Users\pc\Desktop\test` 内：

```txt
C:.
│ 031.gz
└─031
    └─蠢沫沫 - NO.031 惠礼服[40P-436.8M]
            蠢沫沫 - NO.031 惠礼服[40P-436.8M].7z.001
            蠢沫沫 - NO.031 惠礼服[40P-436.8M].7z.002
```

注意被解压的文件，和新增的文件夹的目录层级，他们是并列的。

4. 此时解压文件时，会要求你输入密码。请使用配置文件提供的 `password` 来输入密码。
5. 根据 `isDeletePackages` 配置来决定是否删除掉此时的 `031.gz` 压缩包。
6. 根据文件夹内是否出现 `dirtyFiles` 所出现的文件，做脏文件的删除。
7. 访问目录 `C:\Users\pc\Desktop\test\031\蠢沫沫 - NO.031 惠礼服[40P-436.8M]` ，进入到下一个阶段。

### 3 访问到下一层级并完成分卷解压

1. 继续以上面的例子说明。进到下一个层级，读取有效的分卷压缩文件。此时有效的分卷压缩文件名分别是：
   - `蠢沫沫 - NO.031 惠礼服[40P-436.8M].7z.001`
   - `蠢沫沫 - NO.031 惠礼服[40P-436.8M].7z.002`

使用**分卷压缩的方式**，解压文件。并按照要求输入 `password` 。同样也解压到同一个文件夹。

2. 如果在当前目录层级下，遇到其他的不是分卷压缩的文件时，就直接删除掉。
3. 记录当前被解压的文件名，`蠢沫沫 - NO.031 惠礼服[40P-436.8M]` ，该值将用在和 `isRenameRootFolder` 参数使用时，重命名文件夹的时候使用。
4. 根据 `isDeletePackages` 配置来决定是否删除掉此时的出现的分卷压缩包。
5. 根据文件夹内是否出现 `dirtyFiles` 所出现的文件，做脏文件的删除。
6. 持续访问到最底层的目录 `C:\Users\pc\Desktop\test\031\蠢沫沫 - NO.031 惠礼服[40P-436.8M]\蠢沫沫 - NO.031 惠礼服[40P-436.8M]\蠢沫沫 - NO.031 惠礼服[40P-436.8M]` ，注意此时的目录层级很深，达到了第三层。到下一个层级。

### 4 到达最深处的文件夹层级

1. 此时已经进入到最深处的文件夹内了。
2. 如果此时文件夹内存在一个名为 `孔雀海` 的 Internet 快捷方式，请直接删除掉这个文件，这个文件通常 `dirtyFiles` 内有配置。
3. 根据文件夹内是否出现 `dirtyFiles` 所出现的文件，做脏文件的删除。

### 5 移动图片文件到根目录，并重命名文件夹

1. 根据 `isMoveFilesToRoot` 配置，将最底层的目录 `C:\Users\pc\Desktop\test\031\蠢沫沫 - NO.031 惠礼服[40P-436.8M]\蠢沫沫 - NO.031 惠礼服[40P-436.8M]\蠢沫沫 - NO.031 惠礼服[40P-436.8M]` 出现的文件，全部剪切移动到根压缩包目录内，即 `C:\Users\pc\Desktop\test\031` 文件夹。
2. 根据 `isRenameRootFolder` 配置，来重命名根压缩包文件夹。按照之前已经准备好的文件夹名称，应该重命名为：
   `C:\Users\pc\Desktop\test\031` -> `C:\Users\pc\Desktop\test\蠢沫沫 - NO.031 惠礼服[40P-436.8M]`
3. 删除掉多余的文件夹。比如之前解压出现文件夹，都应该被删除掉。此时的根压缩包文件夹，就应该只包含最纯粹的图片。

至此已完成解压压缩包，删除脏数据，文件移动，文件夹重命名的几个步骤了。

### 6 继续解压处理文件

1. 以 `C:\Users\pc\Desktop\test` 为例子，如果出现了多个 `*.gz` 压缩包文件。就继续处理。
2. 将全部的压缩包文件处理完毕即可。

## 代码编写地址

在以下目录内编写 node 包。

- scripts\decompress-porn-img-package

## 技术栈要求

1. 使用 typescript 编写。
2. 使用 tsdown 完成 typescript 代码构建。
3. 单元测试使用 vitest 。
4. 配置读取使用 c12 来读取。
5. 控制台输出用 consola 来输出信息。

## 代码编写其他要求

1. `@ruan-cat/decompress-porn-img-package` 是私包，避免发布到 npm 镜像内。
2. 根包要安装私包。
3. 配置文件的命名为 `decompress-porn-img-package.config.ts` ，在使用 c12 定义并读取配置文件时，配置文件的核心命名为 `decompress-porn-img-package` 。
4. 务必提供一个干净的入口文件 `src/index.ts` 。
5. 不要并发完成全部压缩包的处理，**一次只处理一个压缩包**。完成一轮操作后，就继续接着完成文件解压处理。
6. 核心业务处理逻辑，会分为好几个步骤，请你适当的拆分这几个步骤，拆分成合适的，独立的业务处理函数，便于阅读。

## 其他要求
